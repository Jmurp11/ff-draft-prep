<div fxLayout="column" fxLayoutAlign="flex-start" fxLayoutGap="0.5%" [style.height.em]="wrapperHeight | async">
  <div fxLayoutAlign="flex-end">
    <div [hidden]="!tableConfig?.useColumnSelector">
      <div fxFlex="column" fxFlexFill fxLayoutAlign="center center" class="p-0">
        <button class="mr-1" mat-mini-fab color="primary" (click)="toggleExpandTable()"
          matTooltip="Toggle Column Width">
          <mat-icon>{{ isTableExpanded ? 'fullscreen_exit' : 'fullscreen'}}</mat-icon>
        </button>
        <button class="mr-1" mat-mini-fab color="primary" (click)="toggleColumnSelector()" matTooltip="Column Selector">
          <mat-icon>{{showColumnSelector ? 'expand_less' : 'expand_more' }}</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <div [hidden]="!showColumnSelector">
    <div>
      <mat-label>Columns to Hide</mat-label>
    </div>
    <div fxLayout="row wrap" fxLayoutAlign="space-around" fxLayoutGap="1%" class="mb-1 pb-1">
      <div *ngFor="let column of columnHideState; let index = index">
        <mat-checkbox [(ngModel)]="column.isHidden" (change)="saveColumnSelector($event)">
          {{ column.columnDisplayName }}</mat-checkbox>
      </div>
    </div>

  </div>
  <div #scrollable class="scrollable" [hidden]="tableConfig == null || tableConfig?.dataSet == null"
    [style.height.em]="tableHeight | async">
    <table mat-table [dataSource]="wrappedTableDataSource" matSort class="mat-elevation-z8"
      [style]="isTableExpanded ? '' : 'table-layout: fixed;'">

      <ng-container *ngFor="let column of tableConfig?.columnsToDisplay; let index=index"
        [matColumnDef]="column.propName" [sticky]="tableConfig.firstColumnSticky ? setColumnSticky(index) : false">
        <th [hidden]="getColumnHideStatus(column)" mat-header-cell *matHeaderCellDef mat-sort-header>
          {{ column.displayValue }}
        </th>
        <td [hidden]="getColumnHideStatus(column)" *matCellDef="let rowData" [class]="column.cellClass"
          [style]="column.cellStyle ? column.cellStyle(rowData) : ''" mat-cell>
          {{ (checkForOverrideExpression(column)  ? callOverrideExpression(column,rowData)  : rowData[column.propName] ) }}
        </td>
      </ng-container>

      <ng-container *ngFor="let action of tableConfig?.actionColumns" [matColumnDef]="action.propName">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let rowData">
          <button mat-icon-button mat-sm-button color="primary" (click)="action.func(rowData)">
            <mat-icon>{{ action.matIcon }}</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="extractedCols; sticky: true"></tr>
      <tr mat-row *matRowDef="let rowData; columns: extractedCols;"
        (click)="tableConfig.rowClick ? tableConfig.rowClick(rowData) : null"></tr>
    </table>
  </div>

  <div fxLayout="row" fxLayoutAlign="start">
    <mat-card class="p-0">
      <mat-card-content class="p-0">
        <mat-paginator #paginator [length]="tableConfig?.dataSet?.length" [pageSize]="tableConfig?.pageDefaultSize"
          [pageSizeOptions]="pageSizeOptions" (click)="scrollToTop()" (page)="paginatorChange($event)"
          [hidden]="tableConfig?.dataSet?.length < (tableConfig?.heightSizes?.truncateHeightAtDataLength || defaultDataSizeForPaginatorVisibility) ">
        </mat-paginator>
      </mat-card-content>
    </mat-card>
  </div>

</div>
